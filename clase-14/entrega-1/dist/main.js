(()=>{var e={929:(e,t,r)=>{function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){u(o,n,a,i,c,"next",e)}function c(e){u(o,n,a,i,c,"throw",e)}i(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=r(33),f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.carts=[],this.path=t}var t,r,n,o,c,u,f,l;return t=e,r=[{key:"saveCart",value:(l=s(regeneratorRuntime.mark((function e(t){var r,n,o,c,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:if(!((r=e.sent)&&r.length>=0)){e.next=15;break}return n=JSON.parse(r),o=n.map((function(e){return e.id})),c=Math.max.apply(Math,i(o)),u=a({id:c+1,timestamp:new Date},t),n.push(u),this.carts=n,d.writeFile(this.carts,this.path),e.abrupt("return",t.id);case 15:s=a({id:1},t),this.carts.push(s),d.writeFile(this.carts,this.path);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"clearbyId",value:(f=s(regeneratorRuntime.mark((function e(t){var r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:if(!(r=e.sent)){e.next=12;break}return n=JSON.parse(r),a=n.filter((function(e){return e.id!==t})),(o=n.find((function(e){return e.id==t}))).product=[],a.push(o),this.carts=a,e.next=12,d.writeFile(this.carts,this.path);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"deleteById",value:(u=s(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:if(!(r=e.sent)){e.next=9;break}return n=JSON.parse(r),a=n.filter((function(e){return e.id!==t})),this.carts=a,e.next=9,d.writeFile(this.carts,this.path);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getById",value:(c=s(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:if(!(r=e.sent)){e.next=11;break}if(n=JSON.parse(r),!(a=n.find((function(e){return e.id==t})))){e.next=10;break}return e.abrupt("return",a.product);case 10:return e.abrupt("return","Invalidad Id");case 11:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"saveProduct",value:(o=s(regeneratorRuntime.mark((function e(t,r){var n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:if(!(n=e.sent)){e.next=10;break}return a=JSON.parse(n),o=a.findIndex((function(e){return e.id==t})),a[o].product.push(r),this.carts=a,e.next=10,d.writeFile(this.carts,this.path);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"deleteProduct",value:(n=s(regeneratorRuntime.mark((function e(t,r){var n,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:if(!(n=e.sent)){e.next=11;break}return a=JSON.parse(n),o=a.find((function(e){return e.id===t})),i=o.product.filter((function(e){return e.id!==r})),o.product=i,e.next=10,this.clearbyId(t);case 10:this.saveProduct(t,o.product);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}],r&&p(t.prototype,r),e}();e.exports=f},462:(e,t,r)=>{function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){u(o,n,a,i,c,"next",e)}function c(e){u(o,n,a,i,c,"throw",e)}i(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=r(33),f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.products=[],this.path=t}var t,r,n,o,c,u,f;return t=e,r=[{key:"getAll",value:(f=s(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"getById",value:(u=s(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:if(!(r=e.sent)){e.next=9;break}if(n=JSON.parse(r),!(a=n.find((function(e){return e.id==t})))){e.next=8;break}return e.abrupt("return",a);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"save",value:(c=s(regeneratorRuntime.mark((function e(t){var r,n,o,c,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:if(!((r=e.sent)&&r.length>=0)){e.next=15;break}return n=JSON.parse(r),o=n.map((function(e){return e.id})),c=Math.max.apply(Math,i(o)),u=a({id:c+1},t),n.push(u),this.products=n,d.writeFile(this.products,this.path),e.abrupt("return",t.id);case 15:s=a({id:1},t),this.products.push(s),d.writeFile(this.products,this.path);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"editById",value:(o=s(regeneratorRuntime.mark((function e(t,r){var n,a,o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:return n=e.sent,a=JSON.parse(n),o=a.findIndex((function(e){return e.id===t})),e.next=7,this.getAll();case 7:i=e.sent,(c=JSON.parse(i))[o].title=r.title,c[o].description=r.description,c[o].code=r.code,c[o].thumbnail=r.thumbnail,c[o].price=r.price,c[o].stock=r.stock,d.writeFile(c,this.path);case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"deleteById",value:(n=s(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.readFile(this.path);case 2:(r=e.sent)&&(n=JSON.parse(r),a=n.filter((function(e){return e.id!==t})),d.writeFile(a,this.path));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}],r&&p(t.prototype,r),e}();e.exports=f},33:(e,t,r)=>{function n(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var i=e.apply(t,r);function c(e){n(i,a,o,c,u,"next",e)}function u(e){n(i,a,o,c,u,"throw",e)}c(void 0)}))}}var o=r(147),i=function(){var e=a(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=JSON.stringify(t,null,2),e.next=4,o.promises.writeFile(r,n);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),"The file cannot be written.";case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}(),c=function(){var e=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.promises.readFile(t,"utf-8");case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),"The file cannot be read.";case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=a(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=JSON.stringify(t,null,2),e.next=4,o.promises.appendFile(r,n);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),"The file cannot be overwritten.";case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}();e.exports={readFile:c,writeFile:i,reWriteFile:u}},579:(e,t,r)=>{var n=r(860),a=n();a.set("views","./views"),a.set("view engine","ejs");var o=r(875),i=r(944);a.use(n.json()),a.use(n.urlencoded({extended:!0})),a.use(n.static("//public")),a.use("/api/products",o),a.use("/api/cart",i),a.use((function(e,t,r){t.status(404).json({error:-2,descripcion:"ruta ".concat(e.url," método '").concat(e.method,"' no implementada")})}));var c=process.env.PORT||8080,u=a.listen(c,(function(){console.log("Servidor http escuchando en el puerto: ".concat(u.address().port))}));u.on("error",(function(e){return console.log("Error en servidor: ".concat(e))})),e.exports=a},944:(e,t,r)=>{function n(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var i=e.apply(t,r);function c(e){n(i,a,o,c,u,"next",e)}function u(e){n(i,a,o,c,u,"throw",e)}c(void 0)}))}}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c=new(0,r(860).Router),u=new(r(929))("./data/cart.txt");c.post("/",(function(e,t){try{var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e.body);u.saveCart(r),t.send("Cart Created")}catch(r){t.status(404).json({error:-2,descripcion:"ruta ".concat(e.url," método '").concat(e.method,"' no implementada")})}})),c.delete("/:id",function(){var e=a(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=parseInt(t.params.id),e.next=4,u.clearbyId(n);case 4:u.deleteById(n),r.send("Cart Removed"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r.status(404).json({error:-2,descripcion:"ruta ".concat(t.url," método '").concat(t.method,"' no implementada")});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}()),c.get("/:id/products",function(){var e=a(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=parseInt(t.params.id),e.next=4,u.getById(n);case 4:a=e.sent,r.json(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r.status(404).json({error:-2,descripcion:"ruta ".concat(t.url," método '").concat(t.method,"' no implementada")});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}()),c.post("/:id/products",(function(e,t){try{var r=parseInt(e.params.id);u.saveProduct(r,e.body),t.send("Product Added")}catch(r){t.status(404).json({error:-2,descripcion:"ruta ".concat(e.url," método '").concat(e.method,"' no implementada")})}})),c.delete("/:id/products/:id_prod",(function(e,t){try{var r=parseInt(e.params.id),n=parseInt(e.params.id_prod);u.deleteProduct(r,n),t.send("Product Deleted")}catch(r){t.status(404).json({error:-2,descripcion:"ruta ".concat(e.url," método '").concat(e.method,"' no implementada")})}})),e.exports=c},875:(e,t,r)=>{function n(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var i=e.apply(t,r);function c(e){n(i,a,o,c,u,"next",e)}function u(e){n(i,a,o,c,u,"throw",e)}c(void 0)}))}}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c=new(0,r(860).Router),u=new(r(462))("./data/products.txt");c.get("/",(function(e,t){try{u.getAll().then((function(e){var r=JSON.parse(e);if(r.length>0)return t.render("pages/list",{title:"List of products",data:r})}))}catch(r){t.json({error:-1,descripcion:"ruta ".concat(e.url," método '").concat(e.method,"' no autorizada")})}})),c.get("/form",(function(e,t){if("true"===e.query.admin)return t.render("pages/addProduct",{title:"Add Product"});t.status(401).json({error:-1,descripcion:"ruta ".concat(e.url," método '").concat(e.method,"' no autorizada")})})),c.get("/:id",(function(e,t){try{var r=parseInt(e.params.id);u.getById(r).then((function(e){if(e)return t.render("pages/product",{title:"Product Detail",data:e})}))}catch(r){t.json({error:-1,descripcion:"ruta ".concat(e.url," método '").concat(e.method,"' no autorizada")})}})),c.post("/add",(function(e,t){try{var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({timestamp:new Date},e.body);u.save(r),setTimeout((function(){t.send('<h2>Product Added</h2><a href="/api/products/" class="btn btn-primary">Ver lista completa</a>')}),3e3)}catch(r){t.json({error:-1,descripcion:"ruta ".concat(e.url," método '").concat(e.method,"' no autorizada")})}})),c.get("/form",(function(e,t){try{if("true"===e.query.admin)return t.render("pages/addProduct",{title:"Add Product"})}catch(e){}})),c.get("/form/:id",(function(e,t){try{if("true"===e.query.admin){var r=parseInt(e.params.id);return void u.getById(r).then((function(e){if(e)return t.render("pages/editProduct",{title:"Edit Product",data:e})}))}}catch(r){t.json({error:-1,descripcion:"ruta ".concat(e.url," método '").concat(e.method,"' no autorizada")})}})),c.put("/:id",function(){var e=a(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"true"!==t.query.admin){e.next=6;break}return n=parseInt(t.params.id),e.next=5,u.editById(n,t.body);case 5:r.send("Producto actualizado");case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r.json({error:-1,descripcion:"ruta ".concat(t.url," método '").concat(t.method,"' no autorizada")});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}()),c.delete("/:id",function(){var e=a(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"true"!==t.query.admin){e.next=6;break}return n=parseInt(t.params.id),e.next=5,u.deleteById(n);case 5:u.getAll().then((function(e){var t=JSON.parse(e);if(t.length>0)return r.render("pages/list",{title:"List of products",data:t})}));case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r.json({error:-1,descripcion:"ruta ".concat(t.url," método '").concat(t.method,"' no autorizada")});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}()),e.exports=c},860:e=>{"use strict";e.exports=require("express")},147:e=>{"use strict";e.exports=require("fs")}},t={};!function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}(579)})();